<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AX Consulting HUB</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/static/style.css" />
  <style>[v-cloak]{display:none}</style>
</head>
<body class="bg-gray-100 flex flex-col h-screen">
  <div id="app" v-cloak class="flex flex-col h-full">
    <header class="bg-white shadow-md flex items-center justify-between p-2 flex-shrink-0">
      <div class="flex items-center space-x-4">
        <h1 class="text-xl font-bold text-gray-800">AX컨설팅HUB</h1>
        <nav class="flex space-x-1">
          <a href="#" class="main-menu-item text-gray-700 hover:text-blue-600 font-medium p-2 rounded-md transition duration-200" :class="{ 'active': activeMenu === 'ax-methodology' }" @click.prevent="setActiveMenu('ax-methodology')">AX방법론</a>
          <a href="#" class="main-menu-item text-gray-700 hover:text-blue-600 font-medium p-2 rounded-md transition duration-200" :class="{ 'active': activeMenu === 'Env_Analysis' }" @click.prevent="setActiveMenu('Env_Analysis')">환경분석</a>
          <a href="#" class="main-menu-item text-gray-700 hover:text-blue-600 font-medium p-2 rounded-md transition duration-200" :class="{ 'active': activeMenu === 'TechEnv_Analysis' }" @click.prevent="setActiveMenu('TechEnv_Analysis')">기술환경분석</a>
          <a href="#" class="main-menu-item text-gray-700 hover:text-blue-600 font-medium p-2 rounded-md transition duration-200" :class="{ 'active': activeMenu === 'Biz_Analysis' }" @click.prevent="setActiveMenu('Biz_Analysis')">Biz요건분석</a>
          <a href="#" class="main-menu-item text-gray-700 hover:text-blue-600 font-medium p-2 rounded-md transition duration-200" :class="{ 'active': activeMenu === 'AXIT_Analysis' }" @click.prevent="setActiveMenu('AXIT_Analysis')">IT요건분석</a>
          <a href="#" class="main-menu-item text-gray-700 hover:text-blue-600 font-medium p-2 rounded-md transition duration-200" :class="{ 'active': activeMenu === 'Visioning' }" @click.prevent="setActiveMenu('Visioning')">Visioning</a>
          <a href="#" class="main-menu-item text-gray-700 hover:text-blue-600 font-medium p-2 rounded-md transition duration-200" :class="{ 'active': activeMenu === 'Target_Model' }" @click.prevent="setActiveMenu('Target_Model')">목표모델</a>
          <a href="#" class="main-menu-item text-gray-700 hover:text-blue-600 font-medium p-2 rounded-md transition duration-200" :class="{ 'active': activeMenu === 'Impl_Tasks' }" @click.prevent="setActiveMenu('Impl_Tasks')">이행과제</a>
          <a href="#" class="main-menu-item text-gray-700 hover:text-blue-600 font-medium p-2 rounded-md transition duration-200" :class="{ 'active': activeMenu === 'Solutions' }" @click.prevent="setActiveMenu('Solutions')">솔루션업체</a>
          <a href="#" class="main-menu-item text-gray-700 hover:text-blue-600 font-medium p-2 rounded-md transition duration-200" :class="{ 'active': activeMenu === 'Roadmap' }" @click.prevent="setActiveMenu('Roadmap')">로드맵수립</a>
        </nav>
      </div>
      <div class="flex items-center justify-between">
        <label class="flex items-center cursor-pointer ml-4">
          <input type="checkbox" v-model="showReferenceMaterials" class="form-checkbox h-5 w-5 text-indigo-600 rounded-md transition duration-200">
          <span class="ml-2 text-gray-700 font-medium whitespace-nowrap">참고자료</span>
        </label>
        <label class="flex items-center cursor-pointer ml-4">
          <input type="checkbox" v-model="useValidation" class="form-checkbox h-5 w-5 text-blue-600 rounded-md transition duration-200">
          <span class="ml-2 text-gray-700 font-medium whitespace-nowrap">결과 검증</span>
        </label>
        <div class="relative inline-block text-left ml-4">
          <select v-model="llmModelSelect" class="block w-full px-2 py-2 text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 transition duration-200">
            <option value="Gemini">Gemini</option>
            <option value="OpenAI">OpenAI</option>
            <option value="Claude">Claude</option>
          </select>
        </div>
      </div>
    </header>

    <!-- 2025-01-17 15:00 KST: 프롬프트 유지 및 지우기 버튼 추가 -->
    <div class="main-container flex-grow flex">
      <!-- 좌측 채팅 패널 -->
      <div class="chatbot-panel">
        <h2 class="text-lg font-semibold text-gray-800 p-4 border-b border-gray-200 flex-shrink-0">
          {{ leftPanelTitle }}
        </h2>

        <div v-if="activeMenu === 'ax-methodology'" class="chatbot-panel-content-wrapper">
          <div class="panel-content">
            <ul v-if="axMethodology.length > 0" class="ax-methodology-list">
              <task-item
                v-for="task in axMethodology"
                :key="task.id"
                :task="task"
                :select-task="selectTask"
                :is-expanded="isExpanded"
                :selected-task="selectedTask"
                :depth="0"
              />
            </ul>
            <p v-else class="text-gray-600 p-4">AX 방법론 메뉴를 로드 중이거나 실패했습니다.</p>
          </div>
        </div>

        <div v-else class="prompt-layout-container">
          <div class="prompt-buttons-area">
            <div v-if="promptGroups.length > 0" class="prompt-group-buttons">
              <button 
                v-for="(group, index) in promptGroups" 
                :key="index"
                @click="selectPromptGroup(index)" 
                class="prompt-group-btn" 
                :class="{ 'active': activePromptIndex === index }">
                {{ group.title }}
              </button>
            </div>
            <div v-else class="no-prompts-message">
              <p v-if="isLoadingPrompts" class="p-4 text-gray-600">템플릿을 불러오는 중...</p>
              <p v-else class="p-4 text-gray-600">미리 정의된 템플릿이 없습니다. 아래에서 자유롭게 프롬프트를 입력하세요.</p>
            </div>
          </div>

          <!-- 2025-01-17 15:00 KST: 지우기 버튼 추가 -->
          <div class="template-info-bar">
            <div class="template-info-content">
             <div class="action-buttons">
                <button @click="clearInput" class="clear-btn-inline" title="프롬프트 지우기">
                  <img src="/static/img/clear.jpg" alt="지우기">
                </button>
              </div>
              <span class="template-instruction" v-if="activePromptIndex !== null">
                아래 템플릿의 하이라이트 부분을 직접 수정하여 프롬프트를 완성하세요.
              </span>
              <span class="template-instruction" v-else>
                자유롭게 프롬프트를 입력하세요.
              </span>
              <div class="action-buttons">
                <button @click="sendMessage" class="send-btn-inline" title="프롬프트 전송">
                  <img src="/static/img/submit.jpg" alt="전송">
                </button>
              </div>
            </div>
          </div>

          <div class="prompt-input-area-wrapper">
            <textarea 
              ref="chatInputRef"
              v-model="chatInput" 
              @input="handleInput"
              @keydown.ctrl.enter="sendMessage"
              placeholder="프롬프트를 입력하세요..."
              class="prompt-textarea-main"
            ></textarea>
          </div>
        </div>
      </div>

      <!-- 중앙 작업 패널 -->
      <div class="workspace-panel rounded-lg shadow-inner">
        <h2 class="text-lg font-semibold text-gray-800 p-4 border-b border-gray-200 flex-shrink-0">
          작업 공간
        </h2>
        <div class="panel-content workspace-content-container">
          <div v-if="isLoading" class="flex justify-center items-center h-full">
            <div class="loading-spinner"></div>
          </div>
          <div v-else v-html="workspaceContent"></div>
        </div>
      </div>

      <!-- 우측 출처 패널 -->
      <div class="source-panel rounded-lg shadow-inner">
        <h2 class="text-lg font-semibold text-gray-800 p-4 border-b border-gray-200 flex-shrink-0">
          {{ showReferenceMaterials ? '참고 자료' : '출처 정보' }}
        </h2>
        <div class="panel-content">
          <div v-if="showReferenceMaterials">
            <div v-if="isLoadingReferences" class="p-4">
              <div class="loading-spinner"></div>
            </div>
            <div v-else-if="referenceFiles.length > 0" class="reference-list">
              <button 
                v-for="(file, index) in referenceFiles" 
                :key="index"
                @click="displayReferenceContent(file)"
                class="reference-item-button"
              >
                {{ file.original_file_name }}
              </button>
            </div>
            <p v-else class="p-4 text-gray-600">참고 자료가 없습니다.</p>
          </div>
          <div v-else>
            <div v-if="sourceInfo.length > 0" class="source-list">
              <div v-for="(source, index) in sourceInfo" :key="index" class="source-item">
                <span class="font-semibold">{{ source.type }}:</span> {{ source.info }}
              </div>
            </div>
            <p v-else class="p-4 text-gray-600">출처 정보가 없습니다.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="/static/script.js"></script>
</body>
</html>
